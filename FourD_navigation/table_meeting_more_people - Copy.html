<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <style type="text/css">
        html,
        body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <title>4D Navigation</title>
    <link rel="shortcut icon" href="  http://cvprndip01.ad.shared:90/doc/menu-doc/net.png" type="image/x-icon" />

    <script src="doc/JS/three.js"></script>
    <script src="doc/JS/OBJLoader.js"></script>
    <script src="doc/JS/MTLLoader.js"></script>
    <script src="doc/JS/OrbitControls.js"></script>
    <!--<script src="doc/JS/stats.min.js"></script>
    <script src="doc/JS/axios.min.js"></script>-->
    <script src="doc/JS/zepto.min.js"></script>
    <script src="doc/JS/TextGeometry.js" type="module"></script>
    <script src="doc/JS/FontLoader.js" type="module"></script>
    <script src="http://yujiangong.com/jslib/vue/vue.js"></script>

    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.24.0/axios.min.js"></script>
    <script src="http://yujiangong.com/jslib/_.js"></script>
    <!-- 引入样式 -->
    <script src="http://yujiangong.com/jslib/vue/index.js"></script>
    <script src="http://yujiangong.com/jslib/vue/en.js"></script>
    <link rel="stylesheet" href="http://yujiangong.com/jslib/vue/index.css">
    <style>
        * {
            font-family: Calibri;
        }

        [but] {
            border: none;
            width: 70px;
            height: 20px;
            border-radius: 2px;
            width: 100px;
            /* background-image:url(./doc/img/ball.png);
             background-position:80% 80%;*/
            border: 1px solid #808080;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
            background-color: transparent;
        }

        [att=Customer] {
            /*  border-color: #2d8cf0;*/
            color: #2d8cf0;
        }

        [att=Process] {
            /* border-color: #19be6b;*/
            color: #19be6b;
        }

        [att=Input] {
            /*  border-color: #ff9900;*/
            color: #ff9900;
        }

        [att=Source] {
            /*    border-color: #808080;*/
            color: #808080;
        }

        .el-card__header {
            padding: 8px;
        }

        .el-card__body {
            padding: 20px 8px;
        }

        .el-card span {
            background-color: transparent;
        }

        body {
            background-image: url(./doc/img/star.jpg); /*Pillars_of_creation.jpg*/
            background-size: cover;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div style="position:fixed;
width:250px;
height:auto;
font-family:Calibri;
left:40px;
top:40px;
font-size:20px;
color:#ffffff;

">

        <!--<b>Izzie, Zhang</b>   NB_20200041
    <br />CoMequasar: 14,021
    <br />CHV $ 91,136.5-->
        <b style="font-size:1.2em;">
            CoMecube Statement
        </b><br />

        Izzie, Zhang<br />
                    <span id="pid">NB_20200041</span> (NFT)<br />
        Quasar Scale: 14,021<br />
        CHV $ 91,136.5
        <br />

        <button but att='Customer' onclick="change_type('Customer')">Customer</button>
        <button but att='Process' onclick="change_type('Process')">Process</button><br />
        <button but att='Input' onclick="change_type('Input')">Input</button>
        <button but att='Source' onclick="change_type('Source')">Source</button>

        <div id="app"
             v-if="show"
             style="position: fixed; width: 100vw; height: 35vh; bottom:0px;z-index:1001; left:0px;
background-color:#fff; font-family: Calibri;  font-size: 16px; ">
            <template>
                <div align="right" style="color:#000; cursor:pointer;" @click="show=false">✕ <i class="" style="cursor:pointer; margin:10px;"></i></div>
                <!--<span>
                    <i>{{program_id}} </i>
                    <b>{{program_deliverable}}</b>
                </span>-->
                <el-table :data="table_data"  :height="auto_height" v-if="src.length==0"
                          border size="mini">
                    <el-table-column v-for="clm in table_clm" :label="th(clm)"  :width="clm.length*14">
                        <template slot-scope="scope">
                           <span v-html="html( (''+scope.row[clm]).split('[')[0].split('|')[0])" ></span>
                        </template>
                    </el-table-column>

                </el-table>
                <iframe :src="src" v-else  style="width:100%; height:100vh;" frameborder="0"></iframe>
            </template>
        </div>
        <!--<div id='app' style="width:300px; padding:4px;
    height:auto;
    object-fit:contain; background-image:url(./doc/img/ball.png);
    border:1px solid #fff;
    border-radius:10px;
    position:fixed;
    top:2vh;
    right:30px;

    vertical-align:middle; padding-top:10px;

    ">



                <el-card class="box-card" size="mini">
                    <div slot="header" class="clearfix">
                        <i class="el-icon-s-operation"></i> <span>Options</span>

                    </div>
                    <el-radio-group v-model="v_type" size="mini">
                        <el-radio-button v-for="n in types" :label="n.name"
                                         :att="n.name"></el-radio-button>

                    </el-radio-group>
                </el-card>
                <el-card class="box-card" size="mini" v-if="table_data.length>0">
                    <div slot="header" class="clearfix">
                        <i class="el-icon-help"></i> <span>Overview</span>

                    </div>
                    <el-table :data="table_data"
                              size="mini">

                        <el-table-column type="expand">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item :label="th('NEW_TECH_PROGRAM_NAME')">
                                        <span>{{ props.row['NEW_TECH_PROGRAM_NAME'] }}</span>
                                    </el-form-item>

                                </el-form>
                            </template>
                        </el-table-column>
                        <el-table-column label="ID">
                            <template slot-scope="scope">
                                {{(''+scope.row['N1_ID']).split('[')[0].split('|')[0]}}
                            </template>
                        </el-table-column>
                        <el-table-column label="FEASIBILITY">
                            <template slot-scope="scope">
                                {{(''+scope.row['FEASIBILITY']).split('[')[0].split('|')[0]}}
                            </template>
                        </el-table-column>
                        <el-table-column label="ACR">
                            <template slot-scope="scope">
                                {{(''+scope.row['ACR']).split('[')[0].split('|')[0]}}
                            </template>
                        </el-table-column>
                        <el-table-column label="OW">
                            <template slot-scope="scope">
                                {{(''+scope.row['OW']).split('[')[0].split('|')[0]}}
                            </template>
                        </el-table-column>
                        <el-table-column label="TCS">
                            <template slot-scope="scope">
                                {{(''+scope.row['TCS']).split('[')[0].split('|')[0]}}
                            </template>
                        </el-table-column>
                        <el-table-column label="PPP">
                            <template slot-scope="scope">
                                {{(''+scope.row['PPP']).split('[')[0].split('|')[0]}}
                            </template>
                        </el-table-column>


                    </el-table>
                </el-card>
            </div>-->

    </div>
    <!--/*background-image:url(./doc/img/ball.png)*/-->
   
    <script>
        const radius = 800;

        let types = [{ name: 'Customer', color: 0x2d8cf0, nickname: 'blue' },
        { name: 'Process', color: 0x19be6b, nickname: 'green' },
        { name: 'Input', color: 0xff9900, nickname: 'orange' },
            { name: 'Source', color: 0x808080, nickname: 'grey' },
            { name: 'all_people', color: 0x663300, nickname: 'brown' }, //bf3426
        ]
        let obj_base = ['14519', '5184', '16911', '31690', '32623', '2426', '24245', '2465'];
        let name_base = ['14519', '5184', '16911', '31690', '32623', '2426', '24245', '2465'
            ,'1000275775','20089','5874','1000277223','1000256166'
        ];
        let counter = +(getQueryString('counter') || "0");
        let common_color = 0xff9900;
        let v_proj_prod_id = getQueryString('v_proj_prod_id') || "NB_20200041";
        let v_owner = getQueryString('v_owner') || "30112";
        window.v_type = types[4]['name'];
        function change_type(name) {
            app.show = false;
            window.v_type = name;
            load_3d();
        }
        var Ctor = Vue.extend({
            data() {
                return {
                    show:false,
                    types, v_type,
                    table_data: [],
                    auto_height: window.innerHeight * 0.32
                }
            },
            watch: {
               
            },
            computed: {
                table_clm() {
                    if (this.table_data.length == 0) {
                        return [];
                    } else {
                        return Object.keys(this.table_data[0]).join(',').replace(',SYS_ID', '').replace('N1_ID', '').replace(',CHECKLIST_ID', '').split(',').filter(function (s) {
                            return s && s.trim();
                        });;
                    }
                }
            },
            methods: {
               remove(arr,val) {
                    var index = arr.indexOf(val);
                    if (index > -1) {
                        arr.splice(index, 1);
                    }
                    return arr;
                },
                html(text) {
                    if (text.includes('ps://')) {
                        return `<a target='_blank' href='${text.replace('ps://','https://')}'>Box link</a>`
                    } else {
                        return text;
                    }
                },
                th(a) {
                    return a.replace(/^v_/g, '').replace(/_/g, ' ').toLowerCase().replace(/^\w|\s\w/g, w => w.toUpperCase());
                },
                td(a, flag = 0) {

                    if (flag) { return unescape(('' + a).split('[')[flag - 1]) }
                    else { return unescape(a); }
                }
            }
        })
        var app = new Ctor().$mount('#app');
        //C:\YUJG\E\daily\2021-12-28\3D Model
        //
        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return "";
        }


        let COLOR = {
            'red': 0x9e2e23,
            'yellow': 0xe2af42,
            'blue': 0x418ab3,
            'green': 0x407d53,
            'blank': 0x404140,
            'grey': 0xa5a5a5
        }
        let page_data = [];
        let font = null;
        var meeting; var loader = new THREE.FontLoader();
        //get font
        loader.load('./doc/fonts/Calibri_Regular.json',
            function (response) {
                // get data
                font = response;
                load_3d();

            });
        function load_3d() {
            //`./api.ashx?type=get_prog_prod_link&v_proj_prod_id=${v_proj_prod_id}&v_owner=${v_owner}&v_type=${v_type.toLowerCase()}`
            //`data.json`
            $.get(`./api.ashx?type=get_prog_prod_link&v_proj_prod_id=${v_proj_prod_id}&v_owner=${v_owner}&v_type=${v_type.toLowerCase()}`, function (data) {
                let leng = data[0].length;
                let ind = Math.floor(leng / 3);
                if (leng > 3) {
                    data[0] = [...data[0].slice(ind, data[0].length), ...data[0].slice(0, ind)]
                }
                page_data = data;
                counter =data[0].length;
                common_color = types.filter(n => { return n.name.toLowerCase() == v_type.toLowerCase() })[0]['color']
                $('canvas').remove();
                meeting = null;
                meeting = new FLOOR_3D(font);
            })

        }
        class FLOOR_3D {
            constructor(font) {
                this.ele = {},
                    this.position = {},
                    this.font = font,
                    this.threeD = {
                        clickObjects: [],
                        scene: new THREE.Scene(),
                        renderer: new THREE.WebGLRenderer({
                            //1217
                            alpha: true,
                            antialias: true
                        }),

                        object: {
                            star: [],
                            dmaic: [],
                            mads: []
                        },
                        material:
                        {
                            a: new THREE.MeshBasicMaterial({
                                color: '#eeeeee', transparent: true,
                                opacity: 0.1
                            })

                        },
                        font: null,
                        OrthographicCamera: (function () {
                            var width = window.innerWidth;
                            var height = window.innerHeight
                            var k = width / height;
                            var s = radius;
                            return new THREE.OrthographicCamera(-s * k, s * k, s, -s, 1, 1000);

                        })(),
                        camera: (function () {

                            return new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 6000);//params

                        })(),
                        point: new THREE.PointLight(0xffffff, 1, 0, 3),
                        ambient: new THREE.AmbientLight(0xffffff, 0.7),
                        DirectionalLight: [new THREE.DirectionalLight(0xffffff, 1),
                        new THREE.DirectionalLight(0xffffff),
                        new THREE.DirectionalLight(),
                        new THREE.DirectionalLight(),
                        new THREE.DirectionalLight()],
                        //0xffffff, 2, 100
                        PointLight: new THREE.SpotLight(0xffffff, 2, 100), //new THREE.AmbientLight(0xffffff), //new THREE.SpotLight(0xffffff, 0.1),
                        helper: new THREE.AxesHelper(radius),
                        // 红线是X轴，绿线是Y轴，蓝线是Z轴
                        definition: {
                            Torus: new THREE.TorusGeometry(4, 1, 16, 18),
                            Cylinder: new THREE.CylinderGeometry(1.5, 2, 9, 18, 10)

                        },
                        model: {},
                        texture: {
                            Pillars_of_creation: new THREE.ImageUtils.loadTexture('./doc/img/star.jpg'),//star
                            star: new THREE.ImageUtils.loadTexture('./doc/img/the-milkyway-2k.jpg'),
                            dalishi: new THREE.ImageUtils.loadTexture('./doc/img/dalishi1.png'),
                            world: new THREE.ImageUtils.loadTexture('./doc/img/world_1.jpg'),
                            dh: new THREE.ImageUtils.loadTexture('./doc/img/dh_name.png')
                            ,
                            arrow_img: new THREE.ImageUtils.loadTexture('./doc/img/wall_left.png')
                            ,
                            legend_img: new THREE.ImageUtils.loadTexture('./doc/img/wall_right.png')
                            ,
                            deliverable_img: new THREE.ImageUtils.loadTexture('./doc/img/wall_base.png')
                        }

                    }

                this.offset = 200;
                this.every_radian = 300;
                this.r = Math.max(160, 240 * counter / 3.14 / 2) | 0;//300 to
                this.box_width = 1000;

                this.init()

            }
            coordinate(center = [0, 0], r, radian) {

                return [center[0] + r * Math.cos(radian), 0 - center[1] + r * Math.sin(radian)]
            }
            load_model(type, scene) {
                var that = this;
                let OBJLoader1 = new THREE.OBJLoader();
                // female_face / female
                //./doc/Model/1227_2/Office Chair.mtl
                let config = {
                    people: "./doc/Model/sx_obj/sx",
                    wd: "./doc/Model/wd/wd",
                    plant: "./doc/Model/plant/desk plant",
                }
                let MTLLoader1 = new THREE.MTLLoader();
                MTLLoader1.load(config[type] + `.mtl`, function (materials) {
                    console.log(materials);
                    OBJLoader1.setMaterials(materials);
                    OBJLoader1.load(config[type] + `.obj`, function (obj) {
                        that.threeD.model[type] = obj;
                        switch (type) {
                            case "wd":
                                that.ele["wd"] = that.threeD.model['wd'].clone();
                                that.ele["wd"].children[0].material.side = THREE.FrontSide;
                               // that.ele["wd"].rotation.x = -Math.PI / 2;
                                that.ele["wd"].position.x = that.box_width / 2 - 140;

                                that.ele["wd"].position.z = -that.box_width / 2+10;
                                that.ele["wd"].position.y = that.box_width * 0.5 - 80
                               // that.ele["wd"].rotation.x = -Math.PI / 2;
                                //that.ele["wd"].position.x = that.box_width / 2-140;

                                //that.ele["wd"].position.z = 0-that.box_width / 2+10;
                                //that.ele["wd"].position.y = that.box_width *0.618-140;
                                //that.ele["wd"].scale.x = counter / 4 ;
                                //that.ele["wd"].scale.y = counter / 4;
                                //that.ele["wd"].scale.z = counter / 4;
                                scene.add(that.ele["wd"]);
                                break;
                            case "plant":
                                that.ele["plant"] = that.threeD.model['plant'].clone();
                                that.ele["plant"].rotation.x = -Math.PI / 2;

                                //that.ele["plant"].position.x = that.r * 2;
                                //that.ele["plant"].position.z =  that.r * 2;
                                that.ele["plant"].scale.x = Math.max(counter / 4, 2, 0.1);
                                that.ele["plant"].scale.y = Math.max(counter / 4, 2, 0.1);
                                that.ele["plant"].scale.z = Math.max(counter / 4, 2, 0.1);
                                scene.add(that.ele["plant"]);
                                break;
                            case "people":
                                //that.ele["_1"] = that.threeD.model[type].clone();
                                //that.ele["_1"].rotation.x = -Math.PI / 2;
                                //that.ele["_1"].position.x = 300;
                                //that.ele["_1"].rotation.z = Math.PI*1.5;
                                //scene.add(that.ele["_1"]);
                                Array(counter).fill(0).map((n, index) => {
                                    let radian = 2 * Math.PI / counter * index;
                                    that.ele["_" + index] = that.threeD.model[type].clone();
                                    that.ele["_" + index].rotation.x = -Math.PI / 2;


                                    [that.ele["_" + index].position.x,
                                    that.ele["_" + index].position.z
                                    ] = that.coordinate([0, 0], that.r + 100, radian);
                                    that.ele["_" + index].rotation.z = 2 * Math.PI - radian;
                                    scene.add(that.ele["_" + index]);

                                })
                                break;
                        }
                    })
                })
            }
            load_people(position_xz, rotation_xz, name, path, scene, fullname) {
                let that = this;
                var OBJLoader1 = new THREE.OBJLoader();
                var MTLLoader1 = new THREE.MTLLoader();
                MTLLoader1.load(`./doc/Model/${path}.mtl`, function (materials) {
                    console.log(materials);
                    OBJLoader1.setMaterials(materials);
                    OBJLoader1.load(`./doc/Model/${path}.obj`, function (obj) {
                        that.ele[name] = that.threeD.model[name] = obj;


                        [that.ele[name].position.x,
                        that.ele[name].position.z
                        ] = position_xz;
                        [that.ele[name].rotation.x, that.ele[name].rotation.z] = rotation_xz;

                        scene.add(that.ele[name]);
                        if (page_data[0][0]['LEADER_ID'] == name) {
                             that.ele[name + "_text"] = that.text_3d("Goodie Me");
                             that.ele[name + "_text"].position.y = 400;
                             [that.ele[name + "_text"].position.x,
                                 that.ele[name + "_text"].position.z
                             ] = position_xz.map(n => { n = n * 1.1; return n; });
                       //   that.ele[name + "_text"].rotation.x =-Math.PI/2;
                             // that.ele[name + "_text"].rotation.z = rotation_xz[1] ;
                             //that.ele[name + "_text"].rotation.y = -Math.PI/2
                            that.ele[name + "_text"].rotation.y = rotation_xz[1] - Math.PI/2;
                             scene.add(that.ele[name + "_text"]);
                        }

                    })
                })




            }
            //yuanhuan
            disk(scene, radius, color) {
                let that = this;
                // 一个外轮廓圆弧嵌套三个内圆弧轮廓
                var shape = new THREE.Shape(); //Shape对象
                //外轮廓
                shape.arc(0, 0, radius, 0, 2 * Math.PI);
                // 内轮廓1
                var path1 = new THREE.Path();
                path1.arc(0, 0, radius * 0.45, 0, 2 * Math.PI);//0.618

                //三个内轮廓分别插入到holes属性中
                shape.holes.push(path1);
                var geometry = new THREE.ExtrudeGeometry(//拉伸造型
                    shape,//二维轮廓
                    //拉伸参数
                    {
                        depth: 20,
                        bevelEnabled: false
                    });

                //bottom
                var shape1 = new THREE.Shape(); //Shape对象
                //外轮廓
                shape1.arc(0, 0, radius * 0.55, 0, 2 * Math.PI);
                // 内轮廓1
                var path11 = new THREE.Path();
                path11.arc(0, 0, radius * 0.45, 0, 2 * Math.PI);

                //三个内轮廓分别插入到holes属性中
                shape1.holes.push(path11);
                var geometry1 = new THREE.ExtrudeGeometry(//拉伸造型
                    shape1,//二维轮廓
                    //拉伸参数
                    {
                        depth: 200,
                        bevelEnabled: false
                    });

                //MeshLambertMaterial
                //MeshNormalMaterial
                var material_top = new THREE.MeshPhongMaterial({
                    ambient: 0x050505, specular: 0x555555, shininess: 30,
                    opacity:1,
                    color: common_color,
                    side: THREE.DoubleSide//两面可见
                });//材质对象
                var material = new THREE.MeshLambertMaterial({

                    color: common_color,
                    side: THREE.DoubleSide//两面可见
                });//材质对象
                // material.map.repeat.set(0.1, 0.1)
                //material.wireframe = true;//线条模式渲染(查看细分数)
                that.ele['disk_top'] = new THREE.Mesh(geometry, material_top);//旋转网格模型对象
                that.ele['disk_top'].position.y = 200;
                that.ele['disk_top'].rotation.x = Math.PI / 2;

                that.ele['disk_bottom'] = new THREE.Mesh(geometry1, material);//旋转网格模型对象
                that.ele['disk_bottom'].position.y = 200;
                that.ele['disk_bottom'].rotation.x = Math.PI / 2;
                scene.add(that.ele['disk_top']); scene.add(that.ele['disk_bottom'])

            }
            text_3d(text = "", size = 18, height = 2, color = 0xffffff, border_color = 0xd5d5d5) {
                let that = this;
                var textGeo = new THREE.TextGeometry(text, {
                    font: that.font,
                    size: size,
                    height: height

                });

                textGeo.computeBoundingBox();

                const centerOffset = - 0.5 * (textGeo.boundingBox.max.x - textGeo.boundingBox.min.x);

                return new THREE.Mesh(textGeo, [
                    new THREE.MeshPhongMaterial({ color: color, flatShading: true }), // front
                    new THREE.MeshPhongMaterial({ color: border_color }) // side
                ]);
            }
            cell_group(arr = [[1, 0, 1], [1, 1, 0], [0, 1, 1]], name = "dh") {
                let that = this;
                var group = new THREE.Group();
                let cell_width = 30;
                let [cell_light_m, cell_black_m] = [new THREE.MeshLambertMaterial({
                    color: 0x418ab3, side: THREE.DoubleSide,
                    opacity: 0.8
                }), new THREE.MeshLambertMaterial({
                    color: 0x999999, side: THREE.DoubleSide,
                    opacity: 1
                })];
                var arr_lose_45 = []; //var arr = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
                var arr_width = arr[0].length;

                arr[0].map((a, ai) => {
                    var arrs = [];
                    arr.map((n, ni) => {

                        arrs.push(n[ai])
                    })
                    arr_lose_45.push(arrs);
                })



                let offset = [(cell_width * 3 + cell_width * 1.6) / 2, (cell_width * 3.5) / 2];

                arr_lose_45.map((n, ni) => {
                    n.map((m, mi) => {
                        that.ele['grid_' + m] = new THREE.Mesh(new THREE.BoxGeometry(cell_width - 4, cell_width, cell_width - 4), !!m ? cell_light_m : cell_black_m);
                        that.ele['grid_' + m].position.set((2 - mi) * cell_width + 4 - offset[0], -cell_width/2, (ni * cell_width + 4) + (cell_width - 4) / 2 - offset[1]);
                        that.ele['grid_' + m].name = 'grid_' + m;
                        that.threeD.clickObjects.push(that.ele['grid_' + m])
                        group.add(that.ele['grid_' + m]);
                    })
                })
                //0xF6416C
                var name_box = new THREE.Mesh(new THREE.BoxGeometry(cell_width * 1.8, cell_width / 8, cell_width * 4 + 8), new THREE.MeshLambertMaterial({
                    map: that.threeD.texture[name], side: THREE.DoubleSide, color: name == page_data[0][0]['LEADER_ID'] ?
                        0xFFF6B7 : 0xFFF6B7

                      
                    ,opacity: 0.9
                }));
                name_box.rotation.z = Math.PI/2
                name_box.position.set(cell_width * 3 + 18 - offset[0], 0, (cell_width * 4 + 8) / 3 - offset[1]);


                group.add(name_box);
                return group;
            }
            goto_fullview(direct='left') {
                // 1451.9626427489884, y: 1659.1365542507192, z: 1342.180461200086
                let that = this, camera = that.threeD.camera, frame_rate = 20,
                    camera_now = {
                        position: [that.threeD.camera.position.x, that.threeD.camera.position.y, that.threeD.camera.position.z],
                        rotation: [that.threeD.camera.rotation.x, that.threeD.camera.rotation.y, that.threeD.camera.rotation.z]
                    },

                    camera_target = [];
                let coordinate = {
                    left: {
                        position: [1808,1660,714],
                        rotation:[-0.848,0.542,0.529]
                    },
                    right: {
                        //position: [459,1660,2088],
                        //rotation: [-0.329,0.254,0.092]
                        position: [950, 1660, 1340],
                        rotation: [-1, 0.6, 0.74]
                    },
                     center: {
                         position: [1450, 1660, 1340],
                         rotation: [-1, 0.6, 0.74]
                    }
                }
                camera_target = coordinate[direct];
                let interval_pos = Array(3).fill(0).map((n, index) => {
                    return ((camera_target.position[index] - camera_now.position[index]) / frame_rate) | 0
                
                })
                let interval_rot = Array(3).fill(0).map((n, index) => {
                    return (camera_target.rotation[index] - camera_now.rotation[index]) / frame_rate

                })
               camera.rotation.set(-1, 0.6, 0.74)
                for (let i = 0; i < frame_rate; i++) {
                    setTimeout(function (D) {
                        camera.position.set(...camera_now.position.map((n, index) => {
                            return n + interval_pos[index] * i;
                        }))
                        camera.rotation.set(...camera_now.rotation.map((n, index) => {
                            return n + interval_rot[index] * i;
                        }))
                        D.renderer.render(D.scene, camera);
                    }, (i + 2) * 25, that.threeD)
                }

            }
            initThreeClickEvent() {
                //点击射线
                let that = this;
                var raycaster = new THREE.Raycaster();
                var mouse = new THREE.Vector2();
                document.body.addEventListener('mousedown', onDocumentMouseDown, false);
                //new THREE.MeshLambertMaterial({
                //    color: COLOR['grey'], side: THREE.DoubleSide,
                //    opacity: 0.5,
                //    wireframe: true

                //})
                function onDocumentMouseDown(event) {
                    event.preventDefault();
                    mouse.x = (event.clientX / that.threeD.renderer.domElement.clientWidth) * 2 - 1;
                    mouse.y = -(event.clientY / that.threeD.renderer.domElement.clientHeight) * 2 + 1;

                    raycaster.setFromCamera(mouse, that.threeD.camera);

                    //总结一下，这里必须装网格，mesh，装入组是没有效果的
                    //所以我们将所有的盒子的网格放入对象就可以了
                    // 需要被监听的对象要存储在clickObjects中。
                    var intersects = raycaster.intersectObjects(that.threeD.clickObjects);

                    // console.log(intersects)
                    if (intersects.length > 0) {
                        // 在这里填写点击代码
                        console.log(intersects);

                        let id = intersects[0].object.name.replace('grid_', '');
                        app.show = true;
                        app.src = "";
                        if (id.includes('PCL')) {
                            app.table_data = page_data[2].filter(n => { return n.CHECKLIST_ID.includes(id) })
                        }
                        else if (id.includes('NPE')) {
                            //$.get('./api.ashx?type=get_npe_deck_overview&v_project_id=' + id, function (data) {
                            //    app.table_data = data;
                            //})
                            app.src = "../npe2.0/get_npe_deck_overview_for_3d.html?v_project_id=" + id;
                        }
                        else {
                            //$.get('./api.ashx?type=GET_PROJECT_ALL_CHECKLIST_STATUS&v_project_id=' + id, function (data) {
                            //    app.table_data = data;
                            //})
                            app.src = `http://cvpmdsip03/tollgate-dy/tgsdome_for_3d.html?v_project_id=${id}`;
                        }
                        if (app.table_data.length == 0) {

                            app.table_data = [{ 'No data': 'No data' }];
                        }

                    }
                }
            }
            init() {
                let that = this;
                let { scene, renderer, point, ambient, material, helper, definition, DirectionalLight, PointLight } = this.threeD;
                let OrthographicCamera = this.threeD.camera;
                const distance = radius,//控制整体尺寸
                    c_zoom = 2;//控制初始化时的球的的大小

                /*******************render*****************/
                //renderer.shadowMapEnabled = true;
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);
                //add milkyway//paras
                let mesh_box = new THREE.Mesh(new THREE.SphereGeometry(distance * 3, distance / 10, distance / 10), new THREE.MeshLambertMaterial({
                    color: '#DFE1E0', side: THREE.BackSide,
                    opacity: 1,
                    map: that.threeD.texture['Pillars_of_creation']
                }));
                mesh_box.geometry.verticesNeedUpdate = true;
                mesh_box.geometry.normalsNeedUpdate = true;
                //1217
                scene.add(mesh_box);
                //add earth
                var earth = new THREE.Mesh(new THREE.SphereGeometry(100, 40, 40),
                    new THREE.MeshStandardMaterial({
                        color: 0xffffff, side: THREE.DoubleSide,

                        map: that.threeD.texture['world']
                    })
                );
                earth.position.x = 0;
                // console.log('h', top)
                earth.position.y = 700;
             //   earth.position.z = -1800;
                earth.position.x = 2200;


                scene.add(earth);
                /*******************helper*****************/
                // scene.add(helper);

                //地板
                //let box width meeting room size
                that.box_width = ((a, b) => {
                    return a * ((8.5 - (b / 3)) | 0)
                })(that.r, counter)
                var mesh = new THREE.Mesh(new THREE.PlaneBufferGeometry(that.box_width, that.box_width), new THREE.MeshPhongMaterial({
                    color: 0xb0b0b0, depthWrite: true,
                    side: THREE.DoubleSide, map: new THREE.ImageUtils.loadTexture('./doc/img/' + v_type + '.png')
                }));//
                mesh.rotation.x = - Math.PI / 2;
                mesh.receiveShadow = true;
                ;
                //wall left
                var wall_left = new THREE.Mesh(new THREE.PlaneBufferGeometry(that.box_width, that.box_width * 0.5),
                    new THREE.MeshPhongMaterial({ color: 0xffffff, opacity: 1, map: that.threeD.texture['deliverable_img'] }));//
                //  mesh.rotation.x = - Math.PI / 2;
                wall_left.position.y = that.box_width * 0.5 / 2
                wall_left.position.z = 0 - that.box_width / 2
                wall_left.receiveShadow = true;
                //wall right
                var wall_right = new THREE.Mesh(new THREE.PlaneBufferGeometry(that.box_width, that.box_width * 0.5),
                    new THREE.MeshPhongMaterial({ color: 0xffffff, opacity: 1, map: that.threeD.texture['arrow_img'] }));//
                //  mesh.rotation.x = - Math.PI / 2;
                wall_right.position.y = that.box_width * 0.5 / 2
                wall_right.rotation.y = Math.PI / 2
                wall_right.position.x = 0 - that.box_width / 2
                wall_right.receiveShadow = true;
                /*                         定义地板割线                      */
                var grid = new THREE.GridHelper(that.box_width, 16, 0x999999, 0x999999);
                grid.material.opacity = 0.7;
                grid.material.transparent = true

                scene.add(mesh); scene.add(wall_left); scene.add(wall_right);
                // scene.add(grid);
                /*******************light 2*****************/
                //DirectionalLight[2].position.set(1000, 200, 1000);
                //scene.add(DirectionalLight[2]);     
                //DirectionalLight[3].position.set(-1000, 200, -1000);
                //scene.add(DirectionalLight[3]);
                //DirectionalLight[0].position.set(0, 400, 0);
                //scene.add(DirectionalLight[0]);

                let directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);
                directionalLight.position.set(-400, 800, 400);
                let dhelper = new THREE.DirectionalLightHelper(directionalLight, 5, 0xff0000);

                let hemisphereLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.9);
                hemisphereLight.position.set(0, 800, 0);
                let hHelper = new THREE.HemisphereLightHelper(hemisphereLight, 5);

                scene.add(directionalLight);
                scene.add(hemisphereLight);
            
                //add desk
                let desktop = new THREE.Mesh(new THREE.CylinderGeometry(that.r, that.r, 20, 40, 20), new THREE.MeshStandardMaterial({
                    color: 0xb3b3b3,
                    //roughness: .9,
                    //    emissive: 0xd5d5d5,
                    //shading: THREE.FlatShading,
                }))
                desktop.position.y = 200;


                that.disk(scene, Math.max(200, that.r), COLOR['red']);
                // scene.add(desktop);
                let deskbottom = new THREE.Mesh(new THREE.CylinderGeometry(that.r / 2.4, that.r / 2.4, 200, 18, 3), new THREE.MeshStandardMaterial({
                    color: 0xa0a0a0,
                    //roughness: .9,
                    //emissive: 0xd5d5d5,
                    //shading: THREE.FlatShading,
                    map: that.threeD.texture['dalishi']
                }))
                deskbottom.position.y = 100;
                // scene.add(deskbottom);

                //that.ele.deskcolor = new THREE.Mesh(new THREE.CylinderGeometry(that.r / 2.4, that.r / 2.4, 3, 38, 3), new THREE.MeshStandardMaterial({
                //       color: COLOR.green,
                //       opacity:.7


                //   }))
                //   that.ele.deskcolor.position.y = 210;
                //   scene.add(that.ele.deskcolor);


                OrthographicCamera.position.set(200 * c_zoom, 300 * c_zoom, 200 * c_zoom);
                OrthographicCamera.lookAt(scene.position);
                var animate = function () {

                    renderer.render(scene, OrthographicCamera);


                };

                animate();
                setTimeout(function () { animate(); }, 700);
                setTimeout(function () { animate(); }, 1800);
                setTimeout(function () { animate(); }, 3500);
                var controls = new THREE.OrbitControls(OrthographicCamera, renderer.domElement);

                controls.maxDistance = 1800 + 1000;
                controls.minDistance = 500;// 300;
                controls.minPolarAngle = Math.PI * (50 / 180);
                controls.maxPolarAngle = Math.PI * (50 / 180);
                controls.addEventListener('change', animate);
                //
                // that.load_model("people", scene);

            //   that.load_model("wd", scene);
                that.load_model("plant", scene);
                //let peoples = ['jacky_obj', 'sx_obj']//, 'vincent_obj', 'Honny','dh_obj' ];
                //let people_name = ['Wu,Donghua', 'Liu,Jacky', 'Zhu,Shixing', 'Jiang,Vincent', 'Chen,Honny'];

                let peoples = [], people_name = [];
                page_data[0].map(n => {
                    peoples.push(n.N1_ID);
                    people_name.push(n.N1_ID_NAME);
                    let c_id = n.N1_ID;
                    if (!name_base.includes(n.N1_ID)) {
                        c_id = "base";//没有就展示一个模型 2426
                        console.log('base', n.N1_ID)
                    }
                    that.threeD.texture[n.N1_ID] = new THREE.ImageUtils.loadTexture('./doc/name_img/' + c_id + '.png')
                    return n;
                })
                Array(counter).fill(0).map((n, index) => {
                    let radian = 2 * Math.PI / counter * index;
                    let current_id = peoples[index];
                    if (!obj_base.includes(current_id)) {
                        current_id = "2426";//没有就展示一个模型 2426
                    }
                    that.load_people(that.coordinate([0, 0], that.r + 70, radian), [-Math.PI / 2, 2 * Math.PI - radian],
                        current_id, current_id + '_obj/sx', scene, people_name[index] || people_name[0])

                    //add point
                    let items = page_data[1].filter(n => { return n.N1_ID == peoples[index] });
                    let itemarrs = Array(9).fill(0);
                    items.map((n, i) => {
                        itemarrs[i] = n.REL_ID;
                        return n;
                    })
                    var g = that.cell_group([[itemarrs[0], itemarrs[1], itemarrs[2]],
                    [itemarrs[3], itemarrs[4], itemarrs[5]],
                    [itemarrs[6], itemarrs[7], itemarrs[8]]], peoples[index] || peoples[0]);
                    [g.position.x, g.position.z, g.position.y] = [...that.coordinate([0, 0], that.r - 80 * (counter / 12), radian),
                    220];
                    //  [g.rotation.x, g.rotation.z] = [-Math.PI / 2, 2 * Math.PI - radian]; //0105 80 to 80
                    g.rotation.y = 2 * Math.PI - radian;
                    g.scale.set(...Array(3).fill(Math.max(5, counter) / 12));//0105 4 to 5
                    scene.add(g);

                })



                that.disk(scene);
                that.initThreeClickEvent();


            }
        }





        function disk_color(color) {
            meeting.ele['disk_top'].material.color = new THREE.Color(color)

        }
    </script>
</body>
</html>